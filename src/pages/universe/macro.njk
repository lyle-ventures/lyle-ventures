---
layout: layouts/universe.njk
title: Macro Cycle Dashboard
permalink: /universe/macro/
---

<div id="macro-app" class="min-h-screen">
  <!-- Header -->
  <div class="border-b border-indigo-500/20 bg-gray-900/50">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <a href="/universe/" class="text-xs text-indigo-400 hover:text-indigo-300 mb-1 inline-block">&larr; Dashboard</a>
          <h1 class="text-xl font-semibold text-gray-100">Macro Cycle Dashboard</h1>
          <p class="text-xs text-gray-500 mt-1">GMI/Bittel Framework | <span id="data-status" class="text-yellow-400">Loading...</span></p>
        </div>
        <div class="flex flex-wrap gap-4 sm:gap-6 text-center">
          <div>
            <p class="text-xs uppercase tracking-wider text-gray-500">Cycle Score</p>
            <p id="cycle-score" class="text-2xl font-bold text-green-400">--</p>
          </div>
          <div>
            <p class="text-xs uppercase tracking-wider text-gray-500">Season</p>
            <p id="cycle-season" class="text-lg font-semibold text-green-400">--</p>
          </div>
          <div>
            <p class="text-xs uppercase tracking-wider text-gray-500">Signal</p>
            <p id="main-signal" class="text-lg font-semibold text-green-400">--</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-4 py-6">

    <!-- Cycle Meter -->
    <div class="universe-card rounded-lg p-6 mb-6">
      <h2 class="text-sm font-bold uppercase tracking-widest text-gray-400 mb-4">Macro Cycle Position</h2>
      <div class="relative">
        <!-- Gradient Bar -->
        <div class="h-8 rounded-full bg-gradient-to-r from-blue-600 via-green-500 via-yellow-500 to-red-500 relative overflow-hidden">
          <!-- Needle -->
          <div id="cycle-needle" class="absolute top-0 bottom-0 w-1 bg-white shadow-lg transition-all duration-500" style="left: 50%">
            <div class="absolute -top-2 left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"></div>
          </div>
        </div>
        <!-- Labels -->
        <div class="flex justify-between mt-2 text-xs text-gray-400">
          <span>WINTER</span>
          <span>SPRING</span>
          <span>SUMMER</span>
          <span>FALL</span>
        </div>
      </div>
    </div>

    <!-- Probability Grid -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="universe-card rounded-lg p-4 text-center">
        <p class="text-xs text-gray-500 uppercase mb-1">Bullish</p>
        <p id="prob-bullish" class="text-2xl font-bold text-green-400">--%</p>
      </div>
      <div class="universe-card rounded-lg p-4 text-center">
        <p class="text-xs text-gray-500 uppercase mb-1">Neutral</p>
        <p id="prob-neutral" class="text-2xl font-bold text-yellow-400">--%</p>
      </div>
      <div class="universe-card rounded-lg p-4 text-center">
        <p class="text-xs text-gray-500 uppercase mb-1">Caution</p>
        <p id="prob-caution" class="text-2xl font-bold text-orange-400">--%</p>
      </div>
      <div class="universe-card rounded-lg p-4 text-center">
        <p class="text-xs text-gray-500 uppercase mb-1">Bearish</p>
        <p id="prob-bearish" class="text-2xl font-bold text-red-400">--%</p>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

      <!-- Left Column: Data Cards -->
      <div class="lg:col-span-2 space-y-6">

        <!-- Key Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Net Liquidity -->
          <div class="universe-card rounded-lg p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400">US Net Liquidity</h3>
              <span id="liq-signal" class="text-xs px-2 py-0.5 rounded bg-green-500/20 text-green-400">--</span>
            </div>
            <p id="net-liquidity" class="text-2xl font-bold text-gray-100">$--</p>
            <p class="text-xs text-gray-500 mt-1">Fed Balance Sheet - TGA - RRP</p>
            <div class="mt-3 pt-3 border-t border-gray-700/50">
              <div class="flex justify-between text-xs">
                <span class="text-gray-500">YoY Change</span>
                <span id="liq-yoy" class="text-green-400">--%</span>
              </div>
            </div>
          </div>

          <!-- Financial Conditions -->
          <div class="universe-card rounded-lg p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400">Financial Conditions</h3>
              <span id="fci-signal" class="text-xs px-2 py-0.5 rounded bg-green-500/20 text-green-400">--</span>
            </div>
            <p id="fci-score" class="text-2xl font-bold text-gray-100">--</p>
            <p class="text-xs text-gray-500 mt-1">Composite Index (0-100)</p>
            <div class="mt-3 pt-3 border-t border-gray-700/50 grid grid-cols-3 gap-2 text-xs">
              <div>
                <p class="text-gray-500">DXY</p>
                <p id="fci-dxy" class="text-gray-300">--</p>
              </div>
              <div>
                <p class="text-gray-500">HY Spread</p>
                <p id="fci-hy" class="text-gray-300">--%</p>
              </div>
              <div>
                <p class="text-gray-500">Curve</p>
                <p id="fci-curve" class="text-gray-300">--%</p>
              </div>
            </div>
          </div>

          <!-- Business Cycle -->
          <div class="universe-card rounded-lg p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400">Business Cycle</h3>
              <span id="ism-signal" class="text-xs px-2 py-0.5 rounded bg-yellow-500/20 text-yellow-400">--</span>
            </div>
            <p id="ism-value" class="text-2xl font-bold text-gray-100">--</p>
            <p class="text-xs text-gray-500 mt-1">ISM Manufacturing PMI</p>
            <div class="mt-3 pt-3 border-t border-gray-700/50">
              <div class="flex justify-between text-xs">
                <span class="text-gray-500">3Mo Momentum</span>
                <span id="ism-momentum" class="text-gray-300">--</span>
              </div>
            </div>
          </div>

          <!-- BTC Analysis -->
          <div class="universe-card rounded-lg p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-xs font-bold uppercase tracking-widest text-gray-400">BTC vs Fair Value</h3>
              <span id="btc-signal" class="text-xs px-2 py-0.5 rounded bg-green-500/20 text-green-400">--</span>
            </div>
            <p id="btc-discount" class="text-2xl font-bold text-green-400">--</p>
            <p class="text-xs text-gray-500 mt-1">Discount to liquidity-implied FV</p>
            <div class="mt-3 pt-3 border-t border-gray-700/50">
              <div class="flex justify-between text-xs">
                <span class="text-gray-500">Fair Value</span>
                <span id="btc-fair-value" class="text-gray-300">$--</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Full Scorecard -->
        <div class="universe-card rounded-lg p-6">
          <h2 class="text-sm font-bold uppercase tracking-widest text-gray-400 mb-4">Indicator Scorecard</h2>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-gray-700">
                  <th class="text-left py-2 text-gray-500 font-medium">Indicator</th>
                  <th class="text-right py-2 text-gray-500 font-medium">Value</th>
                  <th class="text-right py-2 text-gray-500 font-medium">Signal</th>
                  <th class="text-right py-2 text-gray-500 font-medium">Weight</th>
                  <th class="text-right py-2 text-gray-500 font-medium">Score</th>
                </tr>
              </thead>
              <tbody id="scorecard-body">
                <tr><td colspan="5" class="py-4 text-center text-gray-500">Loading data...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Right Column: Controls & Info -->
      <div class="space-y-6">

        <!-- Controls -->
        <div class="universe-card rounded-lg p-6">
          <h2 class="text-sm font-bold uppercase tracking-widest text-gray-400 mb-4">Controls</h2>
          <div class="space-y-3">
            <button onclick="MacroApp.fetchData()" class="w-full py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded text-sm transition-colors">
              Refresh Data
            </button>
            <div>
              <label class="block text-xs text-gray-500 mb-1">BTC Price (manual)</label>
              <input type="number" id="btc-input" value="89500" class="w-full bg-gray-900/50 border border-indigo-500/30 rounded px-3 py-2 text-gray-100 text-sm focus:outline-none focus:border-indigo-500">
            </div>
            <button onclick="MacroApp.updateBtc()" class="w-full py-2 bg-gray-700/50 hover:bg-gray-700 text-gray-300 rounded text-sm transition-colors">
              Update BTC
            </button>
          </div>
        </div>

        <!-- Backtest Presets -->
        <div class="universe-card rounded-lg p-6">
          <h2 class="text-sm font-bold uppercase tracking-widest text-gray-400 mb-4">Backtest Presets</h2>
          <div class="space-y-2">
            <button onclick="MacroApp.loadPreset('2017q4')" class="w-full py-2 bg-gray-700/30 hover:bg-gray-700/50 text-gray-300 rounded text-xs transition-colors text-left px-3">
              Dec 2017 - BTC Peak $19K
            </button>
            <button onclick="MacroApp.loadPreset('2018q4')" class="w-full py-2 bg-gray-700/30 hover:bg-gray-700/50 text-gray-300 rounded text-xs transition-colors text-left px-3">
              Dec 2018 - BTC Bottom $3.2K
            </button>
            <button onclick="MacroApp.loadPreset('2020mar')" class="w-full py-2 bg-gray-700/30 hover:bg-gray-700/50 text-gray-300 rounded text-xs transition-colors text-left px-3">
              Mar 2020 - COVID Crash
            </button>
            <button onclick="MacroApp.loadPreset('2021nov')" class="w-full py-2 bg-gray-700/30 hover:bg-gray-700/50 text-gray-300 rounded text-xs transition-colors text-left px-3">
              Nov 2021 - BTC ATH $69K
            </button>
            <button onclick="MacroApp.loadPreset('2022nov')" class="w-full py-2 bg-gray-700/30 hover:bg-gray-700/50 text-gray-300 rounded text-xs transition-colors text-left px-3">
              Nov 2022 - FTX Collapse
            </button>
            <button onclick="MacroApp.loadPreset('live')" class="w-full py-2 bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-300 rounded text-xs transition-colors text-left px-3">
              Live Data
            </button>
          </div>
        </div>

        <!-- Interpretation Guide -->
        <div class="universe-card rounded-lg p-6">
          <h2 class="text-sm font-bold uppercase tracking-widest text-gray-400 mb-4">Interpretation</h2>
          <div class="space-y-3 text-xs text-gray-400">
            <div>
              <p class="text-green-400 font-semibold">SUMMER (75-100)</p>
              <p>Peak expansion. Risk assets favored. Watch for euphoria.</p>
            </div>
            <div>
              <p class="text-yellow-400 font-semibold">SPRING (55-75)</p>
              <p>Recovery phase. Accumulate risk assets.</p>
            </div>
            <div>
              <p class="text-orange-400 font-semibold">FALL (35-55)</p>
              <p>Late cycle. Reduce risk. Raise cash.</p>
            </div>
            <div>
              <p class="text-blue-400 font-semibold">WINTER (0-35)</p>
              <p>Contraction. Defensive. Wait for bottom signals.</p>
            </div>
          </div>
        </div>

        <!-- FRED Attribution -->
        <div class="universe-card rounded-lg p-4">
          <p class="text-xs text-gray-500">Data from FRED (Federal Reserve Economic Data) via St. Louis Fed API. BTC price from CoinGecko.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ============================================================================
// MACRO CYCLE DASHBOARD APP
// ============================================================================

const MacroApp = {
  // FRED API configuration
  FRED_API_KEY: 'd4040ea5a711a4f85f28d2473086e7bc',
  FRED_BASE: 'https://api.stlouisfed.org/fred/series/observations',

  // Required FRED series
  SERIES: {
    WALCL: 'Fed Balance Sheet',
    WTREGEN: 'Treasury General Account',
    RRPONTSYD: 'Reverse Repo',
    NAPM: 'ISM Manufacturing',
    BAMLH0A0HYM2: 'HY Credit Spread',
    T10Y2Y: 'Yield Curve 10Y-2Y',
    DTWEXBGS: 'Trade-Weighted Dollar'
  },

  // Backtest presets
  PRESETS: {
    '2017q4': { date: '2017-12-15', btc: 19000 },
    '2018q4': { date: '2018-12-15', btc: 3200 },
    '2020mar': { date: '2020-03-15', btc: 5000 },
    '2021nov': { date: '2021-11-10', btc: 69000 },
    '2022nov': { date: '2022-11-21', btc: 16000 },
    '2024mar': { date: '2024-03-14', btc: 73000 },
    'live': { date: null, btc: null }
  },

  // Indicator weights
  WEIGHTS: {
    netLiqYoY: 20,
    dxy: 15,
    hySpread: 10,
    yieldCurve: 10,
    ism: 15,
    ismMomentum: 10,
    btcDiscount: 20
  },

  // State
  state: {
    btcPrice: 89500,
    data: null,
    targetDate: null
  },

  init() {
    const saved = localStorage.getItem('macro_app_state');
    if (saved) {
      this.state = { ...this.state, ...JSON.parse(saved) };
      document.getElementById('btc-input').value = this.state.btcPrice;
    }
    this.fetchData();
  },

  saveState() {
    localStorage.setItem('macro_app_state', JSON.stringify(this.state));
  },

  updateBtc() {
    const price = parseFloat(document.getElementById('btc-input').value);
    if (price > 0) {
      this.state.btcPrice = price;
      this.saveState();
      this.calculate();
    }
  },

  loadPreset(key) {
    const preset = this.PRESETS[key];
    if (preset.date) {
      this.state.targetDate = preset.date;
      this.state.btcPrice = preset.btc;
      document.getElementById('btc-input').value = preset.btc;
      document.getElementById('data-status').textContent = 'Backtest: ' + preset.date;
    } else {
      this.state.targetDate = null;
      document.getElementById('data-status').textContent = 'Live';
    }
    this.saveState();
    this.fetchData();
  },

  async fetchData() {
    document.getElementById('data-status').textContent = 'Fetching...';
    document.getElementById('data-status').className = 'text-yellow-400';

    try {
      const data = {};
      const endDate = this.state.targetDate || new Date().toISOString().split('T')[0];

      // Fetch all series in parallel
      const fetches = Object.entries(this.SERIES).map(async ([id, name]) => {
        try {
          const url = `${this.FRED_BASE}?series_id=${id}&api_key=${this.FRED_API_KEY}&file_type=json&sort_order=desc&limit=100&observation_end=${endDate}`;
          const res = await fetch(url);
          const json = await res.json();
          if (json.observations && json.observations.length > 0) {
            data[id] = json.observations.map(o => ({
              date: o.date,
              value: parseFloat(o.value) || null
            })).filter(o => o.value !== null);
          }
        } catch (e) {
          console.warn(`Failed to fetch ${id}:`, e);
          data[id] = [];
        }
      });

      await Promise.all(fetches);

      // Also fetch BTC if live mode
      if (!this.state.targetDate) {
        try {
          const btcRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
          const btcData = await btcRes.json();
          if (btcData.bitcoin?.usd) {
            this.state.btcPrice = btcData.bitcoin.usd;
            document.getElementById('btc-input').value = this.state.btcPrice;
          }
        } catch (e) {
          console.warn('Failed to fetch BTC price');
        }
      }

      this.state.data = data;
      this.saveState();

      document.getElementById('data-status').textContent = this.state.targetDate ? 'Backtest: ' + this.state.targetDate : 'Live';
      document.getElementById('data-status').className = 'text-green-400';

      this.calculate();
    } catch (e) {
      console.error('Data fetch error:', e);
      document.getElementById('data-status').textContent = 'Error';
      document.getElementById('data-status').className = 'text-red-400';
    }
  },

  calculate() {
    const d = this.state.data;
    if (!d) return;

    const latest = (series) => d[series]?.[0]?.value || null;
    const prev = (series, offset = 1) => d[series]?.[offset]?.value || null;
    const prevYear = (series) => d[series]?.[52]?.value || d[series]?.[d[series]?.length - 1]?.value || null;

    // Calculate net liquidity
    const fedBs = latest('WALCL') ? latest('WALCL') * 1e6 : null; // Millions to dollars
    const tga = latest('WTREGEN') ? latest('WTREGEN') * 1e6 : null;
    const rrp = latest('RRPONTSYD') ? latest('RRPONTSYD') * 1e9 : null; // Billions to dollars
    const netLiq = (fedBs && tga && rrp) ? fedBs - tga - rrp : null;

    // YoY change
    const fedBsPrev = prevYear('WALCL') ? prevYear('WALCL') * 1e6 : null;
    const tgaPrev = prevYear('WTREGEN') ? prevYear('WTREGEN') * 1e6 : null;
    const rrpPrev = prevYear('RRPONTSYD') ? prevYear('RRPONTSYD') * 1e9 : null;
    const netLiqPrev = (fedBsPrev && tgaPrev && rrpPrev) ? fedBsPrev - tgaPrev - rrpPrev : null;
    const netLiqYoY = (netLiq && netLiqPrev) ? ((netLiq - netLiqPrev) / netLiqPrev) * 100 : null;

    // Financial conditions
    const dxy = latest('DTWEXBGS');
    const hySpread = latest('BAMLH0A0HYM2');
    const yieldCurve = latest('T10Y2Y');

    // FCI composite (0-100, higher = looser)
    let fci = 50;
    if (dxy !== null) fci += (110 - dxy) * 2.5;
    if (hySpread !== null) fci += (5 - hySpread) * 6;
    if (yieldCurve !== null) fci += yieldCurve * 10;
    fci = Math.max(0, Math.min(100, fci));

    // ISM
    const ism = latest('NAPM');
    const ism3mo = prev('NAPM', 3);
    const ismMomentum = (ism && ism3mo) ? ism - ism3mo : null;

    // BTC Fair Value (liquidity-based)
    const baseLiq = 5.95e12;
    const baseBtc = 90000;
    const btcFairValue = netLiq ? baseBtc * Math.pow(netLiq / baseLiq, 1.4) : null;
    const btcDiscount = btcFairValue ? ((btcFairValue - this.state.btcPrice) / btcFairValue) * 100 : null;

    // Calculate scores
    const scores = [];

    // Net Liquidity YoY (weight: 20%)
    let liqScore = 0, liqSignal = 'Neutral';
    if (netLiqYoY !== null) {
      if (netLiqYoY > 5) { liqScore = 20; liqSignal = 'Bullish'; }
      else if (netLiqYoY > 0) { liqScore = 10; liqSignal = 'Neutral'; }
      else if (netLiqYoY > -5) { liqScore = 0; liqSignal = 'Caution'; }
      else { liqScore = -10; liqSignal = 'Bearish'; }
    }
    scores.push({ name: 'Net Liquidity YoY', value: netLiqYoY?.toFixed(1) + '%', signal: liqSignal, weight: 20, score: liqScore });

    // DXY (weight: 15%)
    let dxyScore = 0, dxySignal = 'Neutral';
    if (dxy !== null) {
      if (dxy < 105) { dxyScore = 15; dxySignal = 'Bullish'; }
      else if (dxy < 110) { dxyScore = 7; dxySignal = 'Neutral'; }
      else if (dxy < 115) { dxyScore = 0; dxySignal = 'Caution'; }
      else { dxyScore = -8; dxySignal = 'Bearish'; }
    }
    scores.push({ name: 'Trade-Weighted Dollar', value: dxy?.toFixed(1), signal: dxySignal, weight: 15, score: dxyScore });

    // HY Spread (weight: 10%)
    let hyScore = 0, hySignal = 'Neutral';
    if (hySpread !== null) {
      if (hySpread < 4) { hyScore = 10; hySignal = 'Bullish'; }
      else if (hySpread < 5) { hyScore = 5; hySignal = 'Neutral'; }
      else if (hySpread < 6) { hyScore = 0; hySignal = 'Caution'; }
      else { hyScore = -5; hySignal = 'Bearish'; }
    }
    scores.push({ name: 'HY Credit Spread', value: hySpread?.toFixed(2) + '%', signal: hySignal, weight: 10, score: hyScore });

    // Yield Curve (weight: 10%)
    let curveScore = 0, curveSignal = 'Neutral';
    if (yieldCurve !== null) {
      if (yieldCurve > 0.5) { curveScore = 10; curveSignal = 'Bullish'; }
      else if (yieldCurve > 0) { curveScore = 5; curveSignal = 'Neutral'; }
      else if (yieldCurve > -0.3) { curveScore = 0; curveSignal = 'Caution'; }
      else { curveScore = -5; curveSignal = 'Bearish'; }
    }
    scores.push({ name: '10Y-2Y Yield Curve', value: yieldCurve?.toFixed(2) + '%', signal: curveSignal, weight: 10, score: curveScore });

    // ISM (weight: 15%)
    let ismScore = 0, ismSignal = 'Neutral';
    if (ism !== null) {
      if (ism > 52) { ismScore = 15; ismSignal = 'Bullish'; }
      else if (ism > 50) { ismScore = 7; ismSignal = 'Neutral'; }
      else if (ism > 48) { ismScore = 0; ismSignal = 'Caution'; }
      else { ismScore = -8; ismSignal = 'Bearish'; }
    }
    scores.push({ name: 'ISM Manufacturing', value: ism?.toFixed(1), signal: ismSignal, weight: 15, score: ismScore });

    // ISM Momentum (weight: 10%)
    let momScore = 0, momSignal = 'Neutral';
    if (ismMomentum !== null) {
      if (ismMomentum > 1) { momScore = 10; momSignal = 'Bullish'; }
      else if (ismMomentum > 0) { momScore = 5; momSignal = 'Neutral'; }
      else if (ismMomentum > -1) { momScore = 0; momSignal = 'Caution'; }
      else { momScore = -5; momSignal = 'Bearish'; }
    }
    scores.push({ name: 'ISM 3Mo Momentum', value: ismMomentum?.toFixed(1), signal: momSignal, weight: 10, score: momScore });

    // BTC vs Fair Value (weight: 20%)
    let btcScore = 0, btcSignal = 'Neutral';
    if (btcDiscount !== null) {
      if (btcDiscount > 20) { btcScore = 20; btcSignal = 'Bullish'; }
      else if (btcDiscount > 10) { btcScore = 15; btcSignal = 'Bullish'; }
      else if (btcDiscount > 0) { btcScore = 5; btcSignal = 'Neutral'; }
      else if (btcDiscount > -20) { btcScore = 0; btcSignal = 'Caution'; }
      else { btcScore = -10; btcSignal = 'Bearish'; }
    }
    scores.push({ name: 'BTC vs Fair Value', value: btcDiscount?.toFixed(1) + '%', signal: btcSignal, weight: 20, score: btcScore });

    // Calculate total score
    const totalScore = scores.reduce((a, s) => a + s.score, 0);
    const maxScore = scores.reduce((a, s) => a + s.weight, 0);
    const cyclePos = 50 + (totalScore / maxScore) * 50;

    // Determine season
    let season, mainSignal;
    if (cyclePos >= 75) { season = 'SUMMER'; mainSignal = 'Risk On'; }
    else if (cyclePos >= 55) { season = 'SPRING'; mainSignal = 'Accumulate'; }
    else if (cyclePos >= 35) { season = 'FALL'; mainSignal = 'Reduce Risk'; }
    else { season = 'WINTER'; mainSignal = 'Defensive'; }

    // Update UI
    this.updateUI({
      netLiq, netLiqYoY, dxy, hySpread, yieldCurve, fci,
      ism, ismMomentum, btcFairValue, btcDiscount,
      scores, cyclePos, season, mainSignal, liqSignal, btcSignal, ismSignal
    });
  },

  updateUI(data) {
    const fmt = (n) => '$' + (n / 1e12).toFixed(2) + 'T';

    // Header
    document.getElementById('cycle-score').textContent = data.cyclePos.toFixed(0);
    document.getElementById('cycle-season').textContent = data.season;
    document.getElementById('main-signal').textContent = data.mainSignal;

    // Color code season
    const seasonColors = { 'SUMMER': 'text-green-400', 'SPRING': 'text-yellow-400', 'FALL': 'text-orange-400', 'WINTER': 'text-blue-400' };
    document.getElementById('cycle-season').className = 'text-lg font-semibold ' + (seasonColors[data.season] || 'text-gray-400');
    document.getElementById('cycle-score').className = 'text-2xl font-bold ' + (seasonColors[data.season] || 'text-gray-400');

    // Cycle needle position
    document.getElementById('cycle-needle').style.left = data.cyclePos + '%';

    // Probability grid (simplified)
    const bull = Math.max(0, (data.cyclePos - 50) * 2);
    const bear = Math.max(0, (50 - data.cyclePos) * 2);
    const neutral = 100 - bull - bear;
    document.getElementById('prob-bullish').textContent = bull.toFixed(0) + '%';
    document.getElementById('prob-neutral').textContent = Math.max(0, neutral - 20).toFixed(0) + '%';
    document.getElementById('prob-caution').textContent = Math.min(40, Math.max(0, 50 - Math.abs(data.cyclePos - 50))).toFixed(0) + '%';
    document.getElementById('prob-bearish').textContent = bear.toFixed(0) + '%';

    // Data cards
    document.getElementById('net-liquidity').textContent = data.netLiq ? fmt(data.netLiq) : '--';
    document.getElementById('liq-yoy').textContent = data.netLiqYoY ? (data.netLiqYoY > 0 ? '+' : '') + data.netLiqYoY.toFixed(1) + '%' : '--';
    document.getElementById('liq-signal').textContent = data.liqSignal;

    document.getElementById('fci-score').textContent = data.fci.toFixed(0);
    document.getElementById('fci-dxy').textContent = data.dxy?.toFixed(1) || '--';
    document.getElementById('fci-hy').textContent = data.hySpread?.toFixed(2) + '%' || '--';
    document.getElementById('fci-curve').textContent = data.yieldCurve?.toFixed(2) + '%' || '--';

    document.getElementById('ism-value').textContent = data.ism?.toFixed(1) || '--';
    document.getElementById('ism-momentum').textContent = data.ismMomentum ? (data.ismMomentum > 0 ? '+' : '') + data.ismMomentum.toFixed(1) : '--';
    document.getElementById('ism-signal').textContent = data.ismSignal;

    document.getElementById('btc-discount').textContent = data.btcDiscount ? (data.btcDiscount > 0 ? '+' : '') + data.btcDiscount.toFixed(1) + '%' : '--';
    document.getElementById('btc-fair-value').textContent = data.btcFairValue ? '$' + Math.round(data.btcFairValue).toLocaleString() : '--';
    document.getElementById('btc-signal').textContent = data.btcSignal;

    // Signal badges colors
    const signalColors = {
      'Bullish': 'bg-green-500/20 text-green-400',
      'Neutral': 'bg-yellow-500/20 text-yellow-400',
      'Caution': 'bg-orange-500/20 text-orange-400',
      'Bearish': 'bg-red-500/20 text-red-400'
    };
    document.getElementById('liq-signal').className = 'text-xs px-2 py-0.5 rounded ' + (signalColors[data.liqSignal] || '');
    document.getElementById('ism-signal').className = 'text-xs px-2 py-0.5 rounded ' + (signalColors[data.ismSignal] || '');
    document.getElementById('btc-signal').className = 'text-xs px-2 py-0.5 rounded ' + (signalColors[data.btcSignal] || '');

    // Scorecard table
    document.getElementById('scorecard-body').innerHTML = data.scores.map(s => {
      const signalClass = signalColors[s.signal]?.split(' ')[1] || 'text-gray-400';
      return `
        <tr class="border-b border-gray-800/50">
          <td class="py-2 text-gray-300">${s.name}</td>
          <td class="py-2 text-right text-gray-100 font-mono">${s.value || '--'}</td>
          <td class="py-2 text-right ${signalClass}">${s.signal}</td>
          <td class="py-2 text-right text-gray-500">${s.weight}%</td>
          <td class="py-2 text-right font-semibold ${s.score > 0 ? 'text-green-400' : s.score < 0 ? 'text-red-400' : 'text-gray-400'}">${s.score > 0 ? '+' : ''}${s.score}</td>
        </tr>
      `;
    }).join('');
  }
};

document.addEventListener('DOMContentLoaded', () => MacroApp.init());
</script>
